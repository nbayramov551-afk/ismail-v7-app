<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ISMAIL BOSS | V45 ULTRA</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root { --neon: #00ff41; --danger: #ff003c; --blue: #00f2ff; --bg: #000; --gold: #ffd700; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; font-family: 'Orbitron', sans-serif; }

        #matrix-bg { position: fixed; inset: 0; z-index: -1; opacity: 0.15; }

        /* INTRO */
        #intro-screen { position: fixed; inset: 0; z-index: 5000; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .glitch { font-size: 3rem; color: var(--neon); text-shadow: 0 0 10px var(--neon); animation: pulse 1.5s infinite; }

        /* LOGIN */
        #login-screen { position: fixed; inset: 0; z-index: 4000; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; gap: 20px; }
        .btn-main { width: 280px; padding: 20px; border: 2px solid var(--neon); background: transparent; color: var(--neon); font-size: 1.1rem; font-weight: 900; cursor: pointer; border-radius: 5px; box-shadow: 0 0 10px var(--neon); }

        /* RADAR SCAN */
        #scan-screen { position: fixed; inset: 0; z-index: 3000; background: #000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .radar-box { width: 250px; height: 250px; border: 1px solid var(--neon); border-radius: 50%; position: relative; overflow: hidden; }
        .radar-line { position: absolute; width: 100%; height: 100%; background: conic-gradient(from 0deg, transparent, var(--neon)); animation: rotate 2s linear infinite; opacity: 0.4; border-radius: 50%; }
        .scan-txt { margin-top: 20px; font-family: 'Share Tech Mono'; color: var(--neon); text-align: center; }

        /* CHAT APP */
        #app-screen { position: fixed; inset: 0; z-index: 100; display: none; flex-direction: column; }
        .top-bar { padding: 15px; border-bottom: 2px solid var(--neon); display: flex; justify-content: space-between; align-items: center; background: #000; box-shadow: 0 5px 15px rgba(0,255,65,0.2); }
        .feed { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { padding: 12px; border-radius: 10px; max-width: 75%; font-family: 'Share Tech Mono'; line-height: 1.4; font-size: 14px; }
        .me { align-self: flex-end; background: #004d40; border-right: 3px solid var(--blue); }
        .them { align-self: flex-start; background: #212121; border-left: 3px solid var(--neon); }

        .bot-bar { padding: 15px; background: #000; border-top: 1px solid var(--neon); display: flex; flex-direction: column; gap: 10px; }
        .emoji-list { display: flex; justify-content: space-around; font-size: 22px; }
        .input-row { display: flex; gap: 10px; width: 100%; }
        .msg-box { flex: 1; background: #111; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 5px; }

        /* MEDIA LAYER */
        #media-layer { position: fixed; inset: 0; z-index: 6000; background: #000; display: none; }
        #remote-v { width: 100%; height: 100%; object-fit: cover; }
        #local-v { position: absolute; top: 20px; right: 20px; width: 110px; height: 160px; border: 2px solid var(--blue); border-radius: 10px; object-fit: cover; }
        #audio-only-ui { position: fixed; inset: 0; background: radial-gradient(circle, #002200, #000); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 6100; }
        .end-btn { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 75px; height: 75px; background: var(--danger); border-radius: 50%; border: none; color: #fff; font-size: 30px; box-shadow: 0 0 20px var(--danger); }

        @keyframes rotate { 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.98); } 100% { opacity: 1; transform: scale(1.02); } }
    </style>
</head>
<body>

    <canvas id="matrix-bg"></canvas>

    <div id="intro-screen">
        <h1 class="glitch">V45 ULTRA</h1>
        <p style="color:var(--blue); letter-spacing: 3px;">BY ISMAIL BOSS</p>
    </div>

    <div id="login-screen">
        <button class="btn-main" onclick="startSystem('BOSS')">BOSS MODE (HOST)</button>
        <button class="btn-main" onclick="startSystem('GUEST')" style="color:var(--blue); border-color:var(--blue); box-shadow: 0 0 10px var(--blue);">GUEST MODE (JOIN)</button>
    </div>

    <div id="scan-screen">
        <div class="radar-box">
            <div class="radar-line"></div>
            <i class="fas fa-shield-halved fa-4x" style="color:var(--neon); position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); opacity:0.3;"></i>
        </div>
        <div class="scan-txt" id="scan-info">Sƒ∞STEM G√úV∆èNƒ∞Lƒ∞R...<br>BAƒûLANTI AXTARILIR</div>
    </div>

    <div id="app-screen">
        <div class="top-bar">
            <div><b id="user-tag" style="color:var(--neon)">V45 BEAST</b><br><small id="conn-stat" style="color:var(--gold); font-size:10px;">SCANNING...</small></div>
            <div style="display:flex; gap:20px;">
                <i class="fas fa-video fa-lg" style="color:var(--blue)" onclick="callPeer('video')"></i>
                <i class="fas fa-phone fa-lg" style="color:var(--neon)" onclick="callPeer('audio')"></i>
            </div>
        </div>
        <div class="feed" id="chat-feed"></div>
        <div class="bot-bar">
            <div class="emoji-list">
                <span onclick="sendEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span><span onclick="sendEmoji('üî•')">üî•</span>
                <span onclick="sendEmoji('üòÇ')">üòÇ</span><span onclick="sendEmoji('üòÆ')">üòÆ</span>
                <span onclick="sendEmoji('‚ö°Ô∏è')">‚ö°Ô∏è</span>
            </div>
            <div class="input-row">
                <input type="text" id="msg-in" class="msg-box" placeholder="Kripto mesaj...">
                <button onclick="sendTxt()" style="background:transparent; border:none; color:var(--blue); font-size: 25px;"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <div id="media-layer">
        <video id="remote-v" autoplay playsinline></video>
        <video id="local-v" autoplay muted playsinline></video>
        <div id="audio-only-ui">
            <i class="fas fa-user-secret fa-6x" style="color:var(--neon); margin-bottom: 20px;"></i>
            <h2 id="audio-timer">S∆èSLƒ∞ Z∆èNG AKTƒ∞VDƒ∞R</h2>
        </div>
        <button class="end-btn" onclick="terminate()"><i class="fas fa-phone-slash"></i></button>
    </div>

<script>
const ENCRYPT_KEY = "BOSS-V45-SECRET";
const HOST_ID = "ISMAIL-ULTRA-BEAST";
let peer, conn, localStream, currentCall;

// Radar Animasiyasƒ± v…ô Ba≈ülanƒüƒ±c
window.onload = () => {
    initMatrix();
    setTimeout(() => {
        document.getElementById('intro-screen').style.display = 'none';
        document.getElementById('login-screen').style.display = 'flex';
    }, 3500);
};

function startSystem(role) {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('scan-screen').style.display = 'flex';
    
    const myId = (role === 'BOSS') ? HOST_ID : "GUEST-" + Math.floor(Math.random()*9999);
    peer = new Peer(myId, { 
        config: {'iceServers': [{urls:'stun:stun.l.google.com:19302'}, {urls:'stun:stun2.l.google.com:19302'}]},
        debug: 1
    });

    peer.on('open', (id) => {
        if(role === 'GUEST') connectToBoss();
        document.getElementById('scan-info').innerHTML = role + " AKTƒ∞VDƒ∞R...<br>G√úV∆èNLƒ∞ KANAL AXTARILIR";
    });

    peer.on('connection', (c) => {
        conn = c;
        handleConn();
    });

    peer.on('call', incomingCall => {
        if(confirm("G…ôl…ôn ≈üifr…ôli z…ôngi q…ôbul edirsiniz?")) {
            const isVideo = incomingCall.options.constraints.video !== false;
            navigator.mediaDevices.getUserMedia({ 
                video: isVideo ? { facingMode: "user", width: 1280, height: 720 } : false, 
                audio: { echoCancellation: true, noiseSuppression: true } 
            }).then(stream => {
                localStream = stream;
                showMediaUI(isVideo);
                incomingCall.answer(stream);
                incomingCall.on('stream', rs => document.getElementById('remote-v').srcObject = rs);
                currentCall = incomingCall;
            });
        }
    });
}

function connectToBoss() {
    const c = peer.connect(HOST_ID, { reliable: true });
    c.on('open', () => { conn = c; handleConn(); });
    setTimeout(() => { if(!conn) connectToBoss(); }, 3000);
}

function handleConn() {
    document.getElementById('scan-info').innerText = "BAƒûLANTI 100% QURULDU!";
    document.getElementById('scan-info').style.color = "var(--blue)";
    setTimeout(() => {
        document.getElementById('scan-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'flex';
        document.getElementById('conn-stat').innerText = "BAƒûLANTI G√úV∆èNLƒ∞Dƒ∞R";
        confetti({ particleCount: 150, spread: 100 });
    }, 1500);

    conn.on('data', raw => {
        const dec = CryptoJS.AES.decrypt(raw, ENCRYPT_KEY).toString(CryptoJS.enc.Utf8);
        const data = JSON.parse(dec);
        if(data.type === 'msg') addBubble(data.val, 'them');
        if(data.type === 'emo') { triggerConfetti(); addBubble(data.val, 'them'); }
        if(data.type === 'end') terminate(true);
    });
}

// Mesajla≈üma
function sendTxt() {
    const inp = document.getElementById('msg-in');
    if(!inp.value || !conn) return;
    const payload = JSON.stringify({type:'msg', val: inp.value});
    const enc = CryptoJS.AES.encrypt(payload, ENCRYPT_KEY).toString();
    conn.send(enc);
    addBubble(inp.value, 'me');
    inp.value = "";
}

function sendEmoji(emo) {
    const payload = JSON.stringify({type:'emo', val: emo});
    const enc = CryptoJS.AES.encrypt(payload, ENCRYPT_KEY).toString();
    conn.send(enc);
    addBubble(emo, 'me');
    triggerConfetti();
}

function addBubble(txt, owner) {
    const b = document.createElement('div');
    b.className = `bubble ${owner}`;
    b.innerText = txt;
    const f = document.getElementById('chat-feed');
    f.appendChild(b);
    f.scrollTop = f.scrollHeight;
}

// Media (Z…ông) Funksiyalarƒ±
async function callPeer(mode) {
    const isVideo = mode === 'video';
    showMediaUI(isVideo);
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: isVideo ? { facingMode: "user", width: 1280 } : false,
            audio: { echoCancellation: true, noiseSuppression: true }
        });
        localStream = stream;
        document.getElementById('local-v').srcObject = isVideo ? stream : null;
        
        currentCall = peer.call(conn.peer, stream);
        currentCall.on('stream', rs => {
            const rv = document.getElementById('remote-v');
            rv.srcObject = rs;
            rv.play();
        });

        // S…ôsli z…ôngd…ô sensor d…ôst…ôyi simulyasiyasƒ±
        if(!isVideo && 'ProximitySensor' in window) {
            const sensor = new ProximitySensor();
            sensor.onreading = () => {
                document.body.style.opacity = sensor.near ? "0.01" : "1";
            };
            sensor.start();
        }
    } catch(err) { terminate(); alert("Media icaz…ôsi r…ôdd edildi."); }
}

function showMediaUI(isVideo) {
    document.getElementById('media-layer').style.display = 'block';
    document.getElementById('audio-only-ui').style.display = isVideo ? 'none' : 'flex';
    document.getElementById('local-v').style.display = isVideo ? 'block' : 'none';
}

function terminate(remote = false) {
    if(!remote && conn) {
        const enc = CryptoJS.AES.encrypt(JSON.stringify({type:'end'}), ENCRYPT_KEY).toString();
        conn.send(enc);
    }
    if(localStream) localStream.getTracks().forEach(t => t.stop());
    document.getElementById('media-layer').style.display = 'none';
}

function triggerConfetti() {
    confetti({ particleCount: 50, spread: 60, origin: { y: 0.8 } });
}

function initMatrix() {
    const c = document.getElementById('matrix-bg');
    const x = c.getContext('2d');
    c.width = window.innerWidth; c.height = window.innerHeight;
    const drops = Array(Math.floor(c.width/20)).fill(1);
    function draw() {
        x.fillStyle = "rgba(0,0,0,0.05)"; x.fillRect(0,0,c.width,c.height);
        x.fillStyle = "#0f0";
        drops.forEach((y, i) => {
            x.fillText(Math.random() > 0.5 ? "1" : "0", i*20, y*20);
            if(y*20 > c.height && Math.random() > 0.98) drops[i] = 0;
            drops[i]++;
        });
        requestAnimationFrame(draw);
    }
    draw();
}
</script>
</body>
</html>
