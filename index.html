<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SOVEREIGN OMEGA PRO</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">

    <style>
        :root { --neon: #00ff88; --bg: #050505; --panel: #121212; --text: #f0f0f0; --msg-me: #005c4b; --msg-them: #202c33; --danger: #ff3b3b; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* Gƒ∞Rƒ∞≈û LAYERƒ∞ */
        #auth-layer { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: var(--panel); border: 2px solid var(--neon); padding: 40px; border-radius: 40px; width: 100%; max-width: 450px; text-align: center; box-shadow: 0 0 50px rgba(0,255,136,0.15); }
        .profile-upload { width: 120px; height: 120px; border: 3px dashed var(--neon); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; }
        .profile-upload img { width: 100%; height: 100%; object-fit: cover; }

        /* ∆èSAS ƒ∞NTERFEYS */
        .app-container { display: none; height: 100vh; flex-direction: column; }
        .main-header { height: 80px; background: var(--panel); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; border-bottom: 1px solid #222; }
        .tabs { display: flex; background: var(--panel); border-bottom: 1px solid #222; }
        .tab { flex: 1; padding: 15px; text-align: center; color: #777; font-weight: 800; cursor: pointer; }
        .tab.active { color: var(--neon); border-bottom: 3px solid var(--neon); }

        /* √áAT Sƒ∞YAHISI */
        .feed { flex: 1; overflow-y: auto; padding: 15px; background: #000; }
        .user-card { display: flex; align-items: center; padding: 15px; background: var(--panel); border-radius: 20px; margin-bottom: 12px; border: 1px solid #222; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CANLI √áAT P∆èNC∆èR∆èSƒ∞ */
        .window { position: fixed; inset: 0; background: #0b141a; z-index: 5000; transform: translateX(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        .window.active { transform: translateX(0); }
        .msg-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 75%; padding: 12px 18px; border-radius: 20px; font-size: 15px; position: relative; line-height: 1.4; }
        .me { align-self: flex-end; background: var(--msg-me); border-bottom-right-radius: 2px; }
        .them { align-self: flex-start; background: var(--msg-them); border-bottom-left-radius: 2px; }

        /* Z∆èNG EKRANI */
        #call-layer { position: fixed; inset: 0; background: #000; z-index: 20000; display: none; flex-direction: column; align-items: center; justify-content: space-around; }
        .video-full { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
        .video-mini { position: absolute; top: 40px; right: 20px; width: 120px; height: 160px; border-radius: 20px; border: 2px solid var(--neon); z-index: 10; object-fit: cover; }
        .call-btns { z-index: 100; display: flex; gap: 40px; }
        .btn-call { width: 70px; height: 70px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; cursor: pointer; }

        /* DAXƒ∞Lƒ∞ INPUT */
        .input-bar { background: var(--panel); padding: 15px; display: flex; align-items: center; gap: 10px; }
        .boss-input { background: #222; border: none; padding: 15px 20px; border-radius: 30px; color: #fff; flex: 1; outline: none; }
        .fab { width: 55px; height: 55px; border-radius: 50%; background: var(--neon); border: none; font-size: 20px; color: #000; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,255,136,0.3); }
    </style>
</head>
<body>

    <div id="auth-layer">
        <div class="auth-card">
            <h1 style="font-family:'Orbitron'; color:var(--neon); margin-bottom:10px;">OMEGA V8 PRO</h1>
            <p style="color:#666; font-size:12px; margin-bottom:20px;">AES-256 ≈ûƒ∞FR∆èL∆èM∆è AKTƒ∞VDƒ∞R</p>
            <div class="profile-upload" onclick="document.getElementById('f-in').click()">
                <img id="p-img" style="display:none;">
                <i id="p-icon" class="fas fa-user-shield" style="font-size:40px; color:var(--neon);"></i>
            </div>
            <input type="file" id="f-in" hidden onchange="preview(event)">
            <input type="text" id="p-name" class="boss-input" placeholder="Kod adƒ±nƒ±z" style="text-align:center; margin-bottom:15px;">
            <button onclick="login()" style="background:var(--neon); width:100%; padding:18px; border-radius:20px; border:none; font-weight:900; letter-spacing:1px; cursor:pointer;">≈û∆èB∆èK∆èY∆è QO≈ûUL</button>
        </div>
    </div>

    <div class="app-container" id="app">
        <div class="main-header">
            <div style="display:flex; align-items:center; gap:12px;">
                <img id="top-avatar" style="width:45px; height:45px; border-radius:50%; object-fit:cover; border:2px solid var(--neon);">
                <div>
                    <div id="top-name" style="font-weight:900;">Boss</div>
                    <div id="top-id" style="font-size:10px; color:var(--neon); font-family:'Orbitron';">ID: ...</div>
                </div>
            </div>
            <i class="fas fa-cog" style="font-size:20px;" onclick="openSettings()"></i>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="showTab('chats')">MESAJLAR</div>
            <div class="tab" onclick="showTab('status')">STATUS</div>
        </div>
        <div class="feed" id="user-feed"></div>
        <button class="fab" style="position:fixed; bottom:30px; right:30px;" onclick="addFriend()">
            <i class="fas fa-user-plus"></i>
        </button>
    </div>

    <div id="chat-win" class="window">
        <div class="main-header">
            <div style="display:flex; align-items:center; gap:15px;">
                <i class="fas fa-arrow-left" onclick="closeChat()"></i>
                <img id="c-avatar" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                <div id="c-name" style="font-weight:700;">Dost</div>
            </div>
            <div style="display:flex; gap:20px; font-size:18px;">
                <i class="fas fa-video" onclick="call('video')"></i>
                <i class="fas fa-phone" onclick="call('audio')"></i>
            </div>
        </div>
        <div class="msg-area" id="msg-feed"></div>
        <div class="input-bar">
            <i class="fas fa-microphone" id="rec-icon" style="font-size:20px; color:var(--neon);" onmousedown="startRec()" onmouseup="stopRec()"></i>
            <input type="text" id="msg-in" class="boss-input" placeholder="≈ûifr…ôli mesaj yazƒ±n...">
            <button class="fab" style="width:45px; height:45px;" onclick="sendText()">
                <i class="fas fa-paper-plane" style="font-size:16px;"></i>
            </button>
        </div>
    </div>

    <div id="call-layer">
        <video id="remote-v" class="video-full" autoplay playsinline></video>
        <video id="local-v" class="video-mini" autoplay muted playsinline></video>
        <div style="z-index:100; text-align:center;">
            <h2 id="call-status" style="text-shadow: 0 0 10px #000;">Z∆èNG EDƒ∞Lƒ∞R...</h2>
        </div>
        <div class="call-btns" id="out-btns">
            <button class="btn-call" style="background:var(--danger);" onclick="hangup()"><i class="fas fa-phone-slash"></i></button>
        </div>
        <div class="call-btns" id="in-btns" style="display:none;">
            <button class="btn-call" style="background:var(--neon); color:#000;" onclick="answer()"><i class="fas fa-phone"></i></button>
            <button class="btn-call" style="background:var(--danger);" onclick="hangup()"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <audio id="ring" src="https://assets.mixkit.co/active_storage/sfx/1359/1359-preview.mp3" loop></audio>

<script>
    const KEY = "OMEGA_V8_ULTIMATE";
    let peer, profile, activePeer = null, callObj, localStr, recorder, chunks = [];

    function preview(e) {
        const r = new FileReader();
        r.onload = () => { document.getElementById('p-img').src = r.result; document.getElementById('p-img').style.display='block'; document.getElementById('p-icon').style.display='none'; };
        r.readAsDataURL(e.target.files[0]);
    }

    function login() {
        const name = document.getElementById('p-name').value;
        if(!name) return;
        const id = "OMEGA-" + Math.floor(10000 + Math.random() * 90000);
        profile = { id, name, img: document.getElementById('p-img').src || "https://i.imgur.com/8Km9tpg.png" };
        localStorage.setItem('omega_v8_user', JSON.stringify(profile));
        boot();
    }

    function boot() {
        const saved = localStorage.getItem('omega_v8_user');
        if(!saved) return;
        profile = JSON.parse(saved);
        document.getElementById('auth-layer').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('top-name').innerText = profile.name;
        document.getElementById('top-avatar').src = profile.img;
        document.getElementById('top-id').innerText = "ID: " + profile.id;

        peer = new Peer(profile.id, {
            config: {'iceServers': [{ urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:stun1.l.google.com:19302' }]}
        });

        peer.on('connection', conn => {
            conn.on('data', data => handleData(data));
        });

        peer.on('call', c => {
            callObj = c;
            document.getElementById('call-layer').style.display = 'flex';
            document.getElementById('in-btns').style.display = 'flex';
            document.getElementById('out-btns').style.display = 'none';
            document.getElementById('ring').play();
        });

        loadFeed();
    }

    function addFriend() {
        const id = prompt("Dostunuzun OMEGA ID-sini daxil edin:");
        if(!id || id === profile.id) return;
        let db = JSON.parse(localStorage.getItem('omega_v8_db') || "[]");
        if(!db.find(x => x.id === id)) {
            db.push({ id, name: "ƒ∞stifad…ô√ßi " + id.split('-')[1], img: "", msgs: [] });
            localStorage.setItem('omega_v8_db', JSON.stringify(db));
        }
        loadFeed();
    }

    function loadFeed() {
        const feed = document.getElementById('user-feed');
        feed.innerHTML = "";
        const db = JSON.parse(localStorage.getItem('omega_v8_db') || "[]");
        db.forEach(u => {
            feed.innerHTML += `
                <div class="user-card" onclick="openChat('${u.id}')">
                    <img src="${u.img || 'https://i.imgur.com/8Km9tpg.png'}" style="width:50px; height:50px; border-radius:50%; margin-right:15px;">
                    <div style="flex:1">
                        <div style="font-weight:800">${u.name}</div>
                        <div style="font-size:12px; color:#555">üîí AES-256 il…ô qorunur</div>
                    </div>
                </div>`;
        });
    }

    function openChat(id) {
        activePeer = id;
        const db = JSON.parse(localStorage.getItem('omega_v8_db'));
        const u = db.find(x => x.id === id);
        document.getElementById('c-name').innerText = u.name;
        document.getElementById('c-avatar').src = u.img || 'https://i.imgur.com/8Km9tpg.png';
        document.getElementById('chat-win').classList.add('active');
        renderMsgs();
    }

    function sendText() {
        const val = document.getElementById('msg-in').value.trim();
        if(!val) return;
        const packet = { from: profile.id, type: 'text', body: val, time: Date.now() };
        saveAndSend(packet);
        document.getElementById('msg-in').value = "";
    }

    function saveAndSend(p) {
        let db = JSON.parse(localStorage.getItem('omega_v8_db'));
        db.find(x => x.id === activePeer).msgs.push(p);
        localStorage.setItem('omega_v8_db', JSON.stringify(db));
        
        const conn = peer.connect(activePeer);
        conn.on('open', () => {
            conn.send(CryptoJS.AES.encrypt(JSON.stringify(p), KEY).toString());
            renderMsgs();
        });
    }

    function handleData(cipher) {
        const bytes = CryptoJS.AES.decrypt(cipher, KEY);
        const data = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
        let db = JSON.parse(localStorage.getItem('omega_v8_db'));
        let u = db.find(x => x.id === data.from);
        if(u) {
            u.msgs.push(data);
            localStorage.setItem('omega_v8_db', JSON.stringify(db));
            if(activePeer === data.from) renderMsgs();
            notify();
        }
    }

    function renderMsgs() {
        const f = document.getElementById('msg-feed');
        f.innerHTML = "";
        const u = JSON.parse(localStorage.getItem('omega_v8_db')).find(x => x.id === activePeer);
        u.msgs.forEach(m => {
            const side = m.from === profile.id ? 'me' : 'them';
            if(m.type === 'text') f.innerHTML += `<div class="bubble ${side}">${m.body}</div>`;
            else if(m.type === 'voice') f.innerHTML += `<div class="bubble ${side}" onclick="new Audio('${m.body}').play()"><i class="fas fa-play"></i> S…ôsli mesaj</div>`;
        });
        f.scrollTop = f.scrollHeight;
    }

    async function startRec() {
        const s = await navigator.mediaDevices.getUserMedia({ audio: true });
        recorder = new MediaRecorder(s);
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'audio/ogg' });
            const reader = new FileReader();
            reader.onload = () => saveAndSend({ from: profile.id, type: 'voice', body: reader.result });
            reader.readAsDataURL(blob);
            chunks = [];
        };
        recorder.start();
        document.getElementById('rec-icon').style.color = 'red';
    }

    function stopRec() {
        recorder.stop();
        document.getElementById('rec-icon').style.color = 'var(--neon)';
    }

    async function call(type) {
        document.getElementById('call-layer').style.display = 'flex';
        localStr = await navigator.mediaDevices.getUserMedia({ video: type==='video', audio: true });
        document.getElementById('local-v').srcObject = localStr;
        callObj = peer.call(activePeer, localStr);
        callObj.on('stream', s => {
            document.getElementById('remote-v').srcObject = s;
            document.getElementById('call-status').innerText = "CANLI BAƒûLANTI";
        });
    }

    async function answer() {
        document.getElementById('ring').pause();
        document.getElementById('in-btns').style.display = 'none';
        document.getElementById('out-btns').style.display = 'flex';
        localStr = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        document.getElementById('local-v').srcObject = localStr;
        callObj.answer(localStr);
        callObj.on('stream', s => {
            document.getElementById('remote-v').srcObject = s;
            document.getElementById('call-status').innerText = "CANLI BAƒûLANTI";
        });
    }

    function hangup() { location.reload(); }
    function closeChat() { document.getElementById('chat-win').classList.remove('active'); }
    function notify() { if(window.Notification && Notification.permission === "granted") new Notification("Yeni Mesaj!"); }
    
    window.onload = () => { boot(); if(window.Notification) Notification.requestPermission(); };
</script>
</body>
</html>
